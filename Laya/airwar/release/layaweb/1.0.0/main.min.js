var Config_War=function(){function e(){}return e}(),__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},Bg=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.bg1=new Laya.Sprite,this.bg1.loadImage("res/background.png"),this.bg2=new Laya.Sprite,this.bg2.loadImage("res/background.png"),this.bg2.pos(0,-852),this.addChild(this.bg1),this.addChild(this.bg2),Laya.timer.frameLoop(1,this,this.onLoop)},t.prototype.onLoop=function(){this.y+=1,this.bg1.y+this.y>=852&&(this.bg1.y-=1704),this.bg2.y+this.y>=852&&(this.bg2.y-=1704)},t}(Laya.Sprite),__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(e){var t=function(t){function o(){return t.call(this)||this}return __extends(o,t),o.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.GameInfoUI.uiView)},o}(View);t.uiView={type:"View",props:{width:480,height:852},child:[{type:"Button",props:{y:10,x:403,"var":"pauseBtn",stateNum:1,skin:"war/btn_pause.png"}},{type:"Label",props:{y:24,x:107,width:91,"var":"levelLabel",text:"Level:50",height:25,fontSize:20,color:"#f3e9e9"}},{type:"Label",props:{y:24,x:210,width:154,"var":"scoreLabel",text:"Score:100",height:25,fontSize:20,color:"#f8dd18"}},{type:"Label",props:{y:24,x:24,width:74,"var":"hpLabel",text:"Hp:10",height:25,fontSize:20,color:"#62f81c"}},{type:"Label",props:{y:408,x:44,wordWrap:!0,width:392,"var":"infoLabel",text:"战斗结束",height:102,fontSize:30,color:"#ffffff",align:"center"}}]},e.GameInfoUI=t}(ui||(ui={}));var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},GameInfo=function(e){function t(){var t=e.call(this)||this;return t.pauseBtn.on(Laya.Event.CLICK,t,t.onPause),t.reset(),t}return __extends(t,e),t.prototype.reset=function(){this.infoLabel.text="",this.hp(5),this.level(0),this.score(0)},t.prototype.onPause=function(e){e.stopPropagation(),this.infoLabel.text="游戏暂停, 点击开始",gameObj.resume()},t.prototype.hp=function(e){this.hpLabel.text="HP:"+e},t.prototype.level=function(e){this.levelLabel.text="Level:"+e},t.prototype.score=function(e){this.scoreLabel.text="Score:"+e},t}(ui.GameInfoUI),__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},Role=function(e){function t(){var t=e.call(this)||this;return t.shootType=0,t.shootInterval=500,t.shootTime=Laya.Browser.now()+2e3,t.heroType=0,t}return __extends(t,e),t.prototype.init=function(e,o,a,i,n,r){this.type=e,this.camp=o,this.hp=a,this.speed=i,this.hitRadius=n,this.heroType=r,t.cached||(t.cached=!0,Laya.Animation.createFrames(["war/hero_fly1.png","war/hero_fly2.png"],t.HERO_FLY),Laya.Animation.createFrames(["war/hero_down1.png","war/hero_down2.png","war/hero_down3.png","war/hero_down4.png"],t.HERO_DOWN),Laya.Animation.createFrames(["war/enemy1_fly1.png"],t.ENEMY1_FLY),Laya.Animation.createFrames(["war/enemy1_down1.png","war/enemy1_down2.png","war/enemy1_down3.png","war/enemy1_down4.png"],t.ENEMY1_DOWN),Laya.Animation.createFrames(["war/enemy2_fly1.png"],t.ENEMY2_FLY),Laya.Animation.createFrames(["war/enemy2_down1.png","war/enemy2_down2.png","war/enemy2_down3.png","war/enemy2_down4.png"],t.ENEMY2_DOWN),Laya.Animation.createFrames(["war/enemy2_hit.png"],t.ENEMY2_HIT),Laya.Animation.createFrames(["war/enemy3_fly1.png","war/enemy3_fly2.png"],t.ENEMY3_FLY),Laya.Animation.createFrames(["war/enemy3_down1.png","war/enemy3_down2.png","war/enemy3_down3.png","war/enemy3_down4.png","war/enemy3_down5.png","war/enemy3_down6.png"],t.ENEMY3_DOWN),Laya.Animation.createFrames(["war/enemy3_hit.png"],t.ENEMY3_HIT),Laya.Animation.createFrames(["war/bullet1.png"],t.BULLET1_FLY),Laya.Animation.createFrames(["war/ufo1.png"],t.UFO1_FLY),Laya.Animation.createFrames(["war/ufo2.png"],t.UFO2_FLY)),this.body||(this.body=new Laya.Animation,this.body.interval=50,this.body.on(Laya.Event.COMPLETE,this,this.onComplete),this.addChild(this.body)),this.playAction("fly")},t.prototype.playAction=function(e){this.action=e,this.body.play(0,!0,this.type+"_"+e);var t=this.body.getBounds();this.body.pos(-t.width/2,-t.height/2)},t.prototype.onComplete=function(){"down"==this.action?(this.body.stop(),this.visible=!1):"hit"==this.action&&this.playAction("fly")},t}(Laya.Sprite);Role.HERO_FLY="hero_fly",Role.HERO_DOWN="hero_down",Role.ENEMY1_DOWN="enemy1_down",Role.ENEMY2_DOWN="enemy2_down",Role.ENEMY3_DOWN="enemy3_down",Role.ENEMY1_FLY="enemy1_fly",Role.ENEMY2_FLY="enemy2_fly",Role.ENEMY3_FLY="enemy3_fly",Role.BULLET1_FLY="bullet1_fly",Role.UFO1_FLY="ufo1_fly",Role.UFO2_FLY="ufo2_fly",Role.ENEMY2_HIT="enemy2_hit",Role.ENEMY3_HIT="enemy3_hit";var Game=function(){function e(){this.hps=[1,2,10],this.speeds=[3,2,1],this.radius=[15,30,70],this.bulletPos=[[0],[-15,15],[-30,0,30],[-45,-15,15,45]],Laya.init(480,852,Laya.WebGL),Laya.loader.load("res/atlas/war.json",Laya.Handler.create(this,this.onLoaded),null,Laya.Loader.ATLAS),Laya.Stat.show(0,50),Laya.stage.scaleMode="showall",Laya.stage.alignH="center"}return e.prototype.onLoaded=function(){Laya.stage.addChild(new Bg),this.roleBox=new Laya.Sprite,Laya.stage.addChild(this.roleBox),this.hero=new Role,this.roleBox.addChild(this.hero),this.gameInfo=new GameInfo,Laya.stage.addChild(this.gameInfo),this.reStart()},e.prototype.reStart=function(){this.score=0,this.level=0,this.levelUpScore=10,this.bulletLevel=0,this.gameInfo.reset(),this.hero.init("hero",0,5,0,30,0),this.hero.shootType=1,this.hero.shootInterval=400,this.hero.pos(240,700),this.hero.visible=!0;for(var e=this.roleBox.numChildren-1;e>-1;e--){var t=this.roleBox.getChildAt(e);t!=this.hero&&(t.removeSelf(),t.visible=!0,Laya.Pool.recover("role",t))}this.resume()},e.prototype.resume=function(){Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove),Laya.timer.frameLoop(1,this,this.onLoop)},e.prototype.pause=function(){Laya.timer.clear(this,this.onLoop),Laya.stage.off("mousemove",this,this.onMouseMove)},e.prototype.onMouseMove=function(){this.hero.pos(Laya.stage.mouseX,Laya.stage.mouseY)},e.prototype.createEnemy=function(e,t,o,a){for(var i=0;t>i;i++){var n=Laya.Pool.getItemByClass("role",Role);n.init("enemy"+(e+1),1,a,o,this.radius[e],0),n.pos(400*Math.random()+40,200*-Math.random()-100),this.roleBox.addChild(n)}},e.prototype.onLoop=function(){for(var e=this.roleBox.numChildren,t=0;e>t;t++){var o=this.roleBox.getChildAt(t);o&&o.speed&&(o.y+=o.speed,(o.y>1e3||!o.visible||1===o.heroType&&o.y<-100)&&(o.visible=!0,o.removeSelf(),Laya.Pool.recover("role",o)))}this.createBullet(this.hero),e=this.roleBox.numChildren;for(var t=e-1;t>-1;t--){var a=this.roleBox.getChildAt(t);if(!(a.hp<1))for(var i=t-1;i>-1;i--)if(a.visible){var n=this.roleBox.getChildAt(i);if(n.hp>0&&a.camp!=n.camp){var r=a.hitRadius+n.hitRadius;Math.abs(a.x-n.x)<r&&Math.abs(a.y-n.y)<r&&(this.lostHp(a,1),this.lostHp(n,1),this.score++,this.gameInfo.score(this.score),this.score>=this.levelUpScore&&(this.level++,this.gameInfo.level(this.level),this.levelUpScore+=5*this.level))}}}this.hero.hp<1&&(Laya.SoundManager.playSound("res/sound/game_over.mp3"),Laya.timer.clear(this,this.onLoop),Laya.timer.clear(this,this.onLoop),this.gameInfo.infoLabel.text="GameOver，分数："+this.score+"\n点击这里重新开始。",this.gameInfo.infoLabel.once("click",this,this.reStart));var s=this.level<30?2*this.level:60,h=Math.floor(this.level/6),l=Math.floor(this.level/8),p=Math.floor(this.level/10);Laya.timer.currFrame%(80-s)===0&&this.createEnemy(0,2+p,4+h,1),Laya.timer.currFrame%(150-2*s)===0&&this.createEnemy(1,1+p,3+h,2+2*l),Laya.timer.currFrame%(900-4*s)===0&&(this.createEnemy(2,1,1+h,10+5*l),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"))},e.prototype.lostHp=function(e,t){if(e.hp-=t,2==e.heroType)this.bulletLevel++,this.hero.shootType=Math.min(Math.floor(this.bulletLevel/2)+1,4),this.hero.shootInterval=400-16*(this.bulletLevel>20?20:this.bulletLevel),e.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(3==e.heroType)this.hero.hp++,this.hero.hp>=10&&(this.hero.hp=10),this.gameInfo.hp(this.hero.hp),e.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(e.hp>0)e.playAction("hit");else if(e.heroType>0)e.visible=!1;else if("hero"!=e.type&&Laya.SoundManager.playSound("res/sound/"+e.type+"_down.mp3"),e.playAction("down"),"enemy3"==e.type){var o=Math.random()<.7?2:3,a=Laya.Pool.getItemByClass("role",Role);a.init("ufo"+(o-1),e.camp,1,1,15,o),a.pos(e.x,e.y),this.roleBox.addChild(a)}e==this.hero&&this.gameInfo.hp(e.hp)},e.prototype.createBullet=function(e){var t=Laya.Browser.now();if(t>e.shootTime){e.shootTime=t+e.shootInterval;for(var o=this.bulletPos[e.shootType-1],a=0;a<o.length;a++){var i=Laya.Pool.getItemByClass("role",Role);i.init("bullet1",e.camp,1,-5-e.shootType-Math.floor(this.level/15),1,1),i.pos(e.x+o[a],e.y-e.hitRadius-10),this.roleBox.addChild(i)}Laya.SoundManager.playSound("res/sound/bullet.mp3")}},e}(),gameObj=new Game;